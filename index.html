<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿®ä»™ä¸–ç•Œ - Vueç‰ˆ</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <!-- ç™»å½•æ³¨å†Œç•Œé¢ -->
        <div v-if="!isLoggedIn" class="auth-container">
            <div class="auth-modal">
                <div class="auth-header">
                    <h1>ğŸ® ä¿®ä»™ä¸–ç•Œ ğŸ®</h1>
                    <p>è¸ä¸Šä»™é€”ï¼Œé—®é¼è‹ç©¹</p>
                </div>
                
                <div class="auth-tabs">
                    <button 
                        :class="['auth-tab', { active: authMode === 'login' }]"
                        @click="authMode = 'login'"
                    >
                        ç™»å½•
                    </button>
                    <button 
                        :class="['auth-tab', { active: authMode === 'register' }]"
                        @click="authMode = 'register'"
                    >
                        æ³¨å†Œ
                    </button>
                </div>
                
                <form @submit.prevent="authMode === 'login' ? login() : register()" class="auth-form">
                    <div class="form-group">
                        <label>ç”¨æˆ·å</label>
                        <input 
                            type="text" 
                            v-model="authForm.username" 
                            placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
                            required
                        >
                    </div>
                    
                    <div class="form-group">
                        <label>å¯†ç </label>
                        <input 
                            type="password" 
                            v-model="authForm.password" 
                            placeholder="è¯·è¾“å…¥å¯†ç "
                            required
                        >
                    </div>
                    
                    <div v-if="authMode === 'register'" class="form-group">
                        <label>ç¡®è®¤å¯†ç </label>
                        <input 
                            type="password" 
                            v-model="authForm.confirmPassword" 
                            placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç "
                            required
                        >
                    </div>
                    
                    <button type="submit" class="auth-submit">
                        {{ authMode === 'login' ? 'ç™»å½•' : 'æ³¨å†Œ' }}
                    </button>
                </form>
                
                <div v-if="authError" class="auth-error">
                    {{ authError }}
                </div>
            </div>
        </div>
        
        <!-- æ¸¸æˆä¸»ç•Œé¢ -->
        <div v-if="isLoggedIn" class="game-container">
            <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
            <header class="status-bar">
                <div class="player-info">
                    <div class="player-avatar">ğŸ§™â€â™‚ï¸</div>
                    <div class="player-details">
                        <h3>{{ currentUser.username }}</h3>
                        <p>{{ player.realm }} {{ player.level }}å±‚</p>
                    </div>
                </div>
                
                <div class="status-bars">
                    <div class="status-item">
                        <label>ç”Ÿå‘½å€¼</label>
                        <div class="progress-bar">
                            <div class="progress-fill hp" :style="{ width: (player.hp / player.maxHp) * 100 + '%' }"></div>
                            <span class="progress-text">{{ player.hp }}/{{ player.maxHp }}</span>
                        </div>
                    </div>
                    
                    <div class="status-item">
                        <label>çµåŠ›å€¼</label>
                        <div class="progress-bar">
                            <div class="progress-fill mp" :style="{ width: (player.mp / player.maxMp) * 100 + '%' }"></div>
                            <span class="progress-text">{{ player.mp }}/{{ player.maxMp }}</span>
                        </div>
                    </div>
                    
                    <div class="status-item">
                        <label>ä¿®ä¸º</label>
                        <div class="progress-bar">
                            <div class="progress-fill exp" :style="{ width: (player.exp / player.maxExp) * 100 + '%' }"></div>
                            <span class="progress-text">{{ player.exp }}/{{ player.maxExp }}</span>
                        </div>
                    </div>
                </div>
                
                <div class="resources">
                    <div class="resource-item">
                        <span class="resource-icon">ğŸ’°</span>
                        <span>{{ player.gold }}</span>
                    </div>
                    <div class="resource-item">
                        <span class="resource-icon">ğŸ’</span>
                        <span>{{ player.spiritStones }}</span>
                    </div>
                    <div class="resource-item">
                        <span class="resource-icon">â­</span>
                        <span>{{ player.cultivationPoints }}</span>
                    </div>
                </div>
                
                <div class="user-actions">
                    <button @click="saveGame" class="save-btn" :disabled="saving">
                        {{ saving ? 'ä¿å­˜ä¸­...' : 'ğŸ’¾ ä¿å­˜' }}
                    </button>
                    <button @click="logout" class="logout-btn">ğŸšª é€€å‡º</button>
                </div>
            </header>
            
            <!-- ä¸»æ¸¸æˆåŒºåŸŸ -->
            <main class="game-main">
                <!-- å·¦ä¾§é¢æ¿ -->
                <aside class="left-panel">
                    <div class="panel-tabs">
                        <button 
                            v-for="tab in leftTabs" 
                            :key="tab.id"
                            :class="['tab-btn', { active: activeLeftTab === tab.id }]"
                            @click="activeLeftTab = tab.id"
                        >
                            {{ tab.icon }} {{ tab.name }}
                        </button>
                    </div>
                    
                    <!-- ä¿®ç‚¼é¢æ¿ -->
                    <div v-if="activeLeftTab === 'cultivation'" class="tab-content">
                        <!-- æ‰‹åŠ¨ä¿®ç‚¼ -->
                        <div class="cultivation-section">
                            <h4>ğŸ”¥ æ‰‹åŠ¨ä¿®ç‚¼</h4>
                            <div class="cultivation-methods">
                                <div class="method-card">
                                    <h5>ğŸ§˜ æ‰“åå†¥æƒ³</h5>
                                    <p>åŸºç¡€ä¿®ç‚¼æ–¹å¼ï¼Œç¨³å®šè·å¾—ä¿®ä¸º</p>
                                    <button
                                        @click="startCultivation('meditation')"
                                        :disabled="isCultivating"
                                        class="method-btn"
                                    >
                                        {{ isCultivating && cultivationType === 'meditation' ? 'ä¿®ç‚¼ä¸­...' : 'å¼€å§‹ä¿®ç‚¼' }}
                                    </button>
                                </div>

                                <div class="method-card">
                                    <h5>âš¡ é˜µæ³•ä¿®ç‚¼</h5>
                                    <p>æ¶ˆè€—çµçŸ³ï¼Œå¿«é€Ÿæå‡ä¿®ä¸º</p>
                                    <p class="cost">æ¶ˆè€—ï¼š1çµçŸ³/åˆ†é’Ÿ</p>
                                    <button
                                        @click="startCultivation('formation')"
                                        :disabled="isCultivating || player.spiritStones < 1"
                                        class="method-btn"
                                    >
                                        {{ isCultivating && cultivationType === 'formation' ? 'ä¿®ç‚¼ä¸­...' : 'å¼€å§‹ä¿®ç‚¼' }}
                                    </button>
                                </div>
                            </div>

                            <div v-if="isCultivating" class="cultivation-timer">
                                <h5>ä¿®ç‚¼è¿›è¡Œä¸­</h5>
                                <div class="timer">{{ formatTime(cultivationTime) }}</div>
                                <button @click="stopCultivation" class="stop-btn">åœæ­¢ä¿®ç‚¼</button>
                            </div>
                        </div>

                        <!-- è‡ªåŠ¨ä¿®ç‚¼ -->
                        <div class="cultivation-section">
                            <h4>ğŸ¤– è‡ªåŠ¨ä¿®ç‚¼</h4>
                            <div v-if="!autoCultivationActive" class="auto-cultivation-setup">
                                <p>é€‰æ‹©è‡ªåŠ¨ä¿®ç‚¼æ–¹å¼ï¼Œç¦»çº¿æ—¶ä¹Ÿèƒ½æŒç»­ä¿®ç‚¼</p>
                                <div class="auto-methods">
                                    <div class="auto-method-card">
                                        <h5>ğŸ§˜ è‡ªåŠ¨æ‰“å</h5>
                                        <p>æ¯å°æ—¶60ç»éªŒï¼Œæ— æ¶ˆè€—</p>
                                        <button @click="startAutoCultivation('meditation')" class="auto-btn">
                                            å¼€å§‹è‡ªåŠ¨ä¿®ç‚¼
                                        </button>
                                    </div>

                                    <div class="auto-method-card">
                                        <h5>âš¡ è‡ªåŠ¨é˜µæ³•</h5>
                                        <p>æ¯å°æ—¶180ç»éªŒï¼Œæ¶ˆè€—10çµçŸ³/å°æ—¶</p>
                                        <button
                                            @click="startAutoCultivation('formation')"
                                            :disabled="player.spiritStones < 10"
                                            class="auto-btn"
                                        >
                                            å¼€å§‹è‡ªåŠ¨ä¿®ç‚¼
                                        </button>
                                    </div>

                                    <div class="auto-method-card">
                                        <h5>ğŸ’Š ä¸¹è¯è¾…åŠ©</h5>
                                        <p>æ¯å°æ—¶300ç»éªŒï¼Œæ¶ˆè€—50é‡‘å¸/å°æ—¶</p>
                                        <button
                                            @click="startAutoCultivation('pill_assisted')"
                                            :disabled="player.gold < 50"
                                            class="auto-btn"
                                        >
                                            å¼€å§‹è‡ªåŠ¨ä¿®ç‚¼
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div v-if="autoCultivationActive" class="auto-cultivation-status">
                                <h5>{{ getCultivationTypeName(autoCultivationType) }}è¿›è¡Œä¸­</h5>
                                <p>å¼€å§‹æ—¶é—´: {{ new Date(autoCultivationStartTime).toLocaleString() }}</p>
                                <p>ä¿®ç‚¼ç±»å‹: {{ getCultivationTypeName(autoCultivationType) }}</p>
                                <button @click="stopAutoCultivation" class="stop-auto-btn">
                                    åœæ­¢è‡ªåŠ¨ä¿®ç‚¼
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æŠ€èƒ½é¢æ¿ -->
                    <div v-if="activeLeftTab === 'skills'" class="tab-content">
                        <div class="skills-grid">
                            <div 
                                v-for="(skill, skillName) in player.skills" 
                                :key="skillName"
                                :class="['skill-card', { locked: skill.locked }]"
                            >
                                <div class="skill-icon">{{ getSkillIcon(skillName) }}</div>
                                <h4>{{ getSkillName(skillName) }}</h4>
                                <div class="skill-level">ç­‰çº§: {{ skill.level }}</div>
                                <button 
                                    @click="upgradeSkill(skillName)"
                                    :disabled="skill.locked || player.cultivationPoints < getUpgradeCost(skill.level)"
                                    class="upgrade-btn"
                                >
                                    {{ skill.locked ? 'æœªè§£é”' : `å‡çº§ (${getUpgradeCost(skill.level)}ä¿®ä¸º)` }}
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- èƒŒåŒ…é¢æ¿ -->
                    <div v-if="activeLeftTab === 'inventory'" class="tab-content">
                        <div class="inventory-header">
                            <h4>èƒŒåŒ… ({{ getInventoryCount() }}/50)</h4>
                        </div>
                        <div class="inventory-grid">
                            <div 
                                v-for="(item, index) in getInventoryItems()" 
                                :key="index"
                                class="inventory-slot occupied"
                                :title="item.name"
                                @click="useItem(item.name)"
                            >
                                <div class="item-icon">{{ getItemIcon(item.name) }}</div>
                                <div class="item-count">{{ item.count }}</div>
                            </div>
                            <div 
                                v-for="n in (50 - getInventoryCount())" 
                                :key="'empty-' + n"
                                class="inventory-slot"
                            ></div>
                        </div>
                    </div>
                    
                    <!-- ä»»åŠ¡é¢æ¿ -->
                    <div v-if="activeLeftTab === 'quests'" class="tab-content">
                        <div class="quest-tabs">
                            <button
                                :class="['quest-tab', { active: activeQuestTab === 'available' }]"
                                @click="activeQuestTab = 'available'"
                            >
                                å¯æ¥å— ({{ availableQuests.length }})
                            </button>
                            <button
                                :class="['quest-tab', { active: activeQuestTab === 'active' }]"
                                @click="activeQuestTab = 'active'"
                            >
                                è¿›è¡Œä¸­ ({{ activeQuests.length }})
                            </button>
                            <button
                                :class="['quest-tab', { active: activeQuestTab === 'completed' }]"
                                @click="activeQuestTab = 'completed'"
                            >
                                å·²å®Œæˆ ({{ completedQuests.length }})
                            </button>
                        </div>

                        <!-- å¯æ¥å—ä»»åŠ¡ -->
                        <div v-if="activeQuestTab === 'available'" class="quest-list">
                            <div
                                v-for="quest in availableQuests"
                                :key="quest.id"
                                class="quest-card available"
                            >
                                <div class="quest-header">
                                    <h5>{{ quest.title }}</h5>
                                    <span class="quest-type">{{ quest.quest_type }}</span>
                                </div>
                                <p class="quest-description">{{ quest.description }}</p>
                                <div class="quest-requirements">
                                    <h6>ä»»åŠ¡è¦æ±‚:</h6>
                                    <ul>
                                        <li v-for="(value, key) in quest.requirements" :key="key">
                                            {{ getRequirementText(key, value) }}
                                        </li>
                                    </ul>
                                </div>
                                <div class="quest-rewards">
                                    <h6>ä»»åŠ¡å¥–åŠ±:</h6>
                                    <div class="reward-items">
                                        <span v-if="quest.rewards.exp" class="reward-item">
                                            â­ {{ quest.rewards.exp }}ç»éªŒ
                                        </span>
                                        <span v-if="quest.rewards.gold" class="reward-item">
                                            ğŸ’° {{ quest.rewards.gold }}é‡‘å¸
                                        </span>
                                        <span v-if="quest.rewards.spirit_stones" class="reward-item">
                                            ğŸ’ {{ quest.rewards.spirit_stones }}çµçŸ³
                                        </span>
                                    </div>
                                </div>
                                <button @click="acceptQuest(quest.id)" class="quest-accept-btn">
                                    æ¥å—ä»»åŠ¡
                                </button>
                            </div>
                        </div>

                        <!-- è¿›è¡Œä¸­ä»»åŠ¡ -->
                        <div v-if="activeQuestTab === 'active'" class="quest-list">
                            <div
                                v-for="quest in activeQuests"
                                :key="quest.id"
                                class="quest-card active"
                            >
                                <div class="quest-header">
                                    <h5>{{ quest.title }}</h5>
                                    <span class="quest-type">{{ quest.quest_type }}</span>
                                </div>
                                <p class="quest-description">{{ quest.description }}</p>
                                <div class="quest-progress">
                                    <h6>è¿›åº¦:</h6>
                                    <div v-for="(value, key) in quest.requirements" :key="key" class="progress-item">
                                        <span>{{ getRequirementText(key, value) }}</span>
                                        <div class="progress-bar">
                                            <div
                                                class="progress-fill"
                                                :style="{ width: Math.min(100, ((quest.progress[key] || 0) / value) * 100) + '%' }"
                                            ></div>
                                        </div>
                                        <span class="progress-text">{{ quest.progress[key] || 0 }}/{{ value }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- å·²å®Œæˆä»»åŠ¡ -->
                        <div v-if="activeQuestTab === 'completed'" class="quest-list">
                            <div
                                v-for="quest in completedQuests"
                                :key="quest.id"
                                class="quest-card completed"
                            >
                                <div class="quest-header">
                                    <h5>{{ quest.title }}</h5>
                                    <span class="quest-type">{{ quest.quest_type }}</span>
                                </div>
                                <p class="quest-description">{{ quest.description }}</p>
                                <div class="quest-rewards">
                                    <h6>ä»»åŠ¡å¥–åŠ±:</h6>
                                    <div class="reward-items">
                                        <span v-if="quest.rewards.exp" class="reward-item">
                                            â­ {{ quest.rewards.exp }}ç»éªŒ
                                        </span>
                                        <span v-if="quest.rewards.gold" class="reward-item">
                                            ğŸ’° {{ quest.rewards.gold }}é‡‘å¸
                                        </span>
                                        <span v-if="quest.rewards.spirit_stones" class="reward-item">
                                            ğŸ’ {{ quest.rewards.spirit_stones }}çµçŸ³
                                        </span>
                                    </div>
                                </div>
                                <button @click="claimQuestReward(quest.id)" class="quest-claim-btn">
                                    é¢†å–å¥–åŠ±
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- æˆå°±é¢æ¿ -->
                    <div v-if="activeLeftTab === 'achievements'" class="tab-content">
                        <div class="achievements-list">
                            <div
                                v-for="achievement in achievements"
                                :key="achievement.id"
                                :class="['achievement-card', { completed: achievement.completed }]"
                            >
                                <div class="achievement-icon">{{ achievement.icon }}</div>
                                <div class="achievement-info">
                                    <h4>{{ achievement.name }}</h4>
                                    <p>{{ achievement.description }}</p>
                                    <div class="achievement-progress">
                                        <div class="progress-bar">
                                            <div class="progress-fill" :style="{ width: Math.min(100, (achievement.current / achievement.target) * 100) + '%' }"></div>
                                        </div>
                                        <span class="progress-text">{{ achievement.current }}/{{ achievement.target }}</span>
                                    </div>
                                    <div v-if="achievement.completed" class="achievement-reward">å¥–åŠ±: {{ achievement.reward }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å®—é—¨é¢æ¿ -->
                    <div v-if="activeLeftTab === 'sect'" class="tab-content">
                        <div v-if="!player.sect" class="sect-selection">
                            <h4>é€‰æ‹©å®—é—¨</h4>
                            <div class="sects-grid">
                                <div 
                                    v-for="sect in availableSects" 
                                    :key="sect.id"
                                    class="sect-card"
                                    @click="joinSect(sect.id)"
                                >
                                    <div class="sect-icon">{{ sect.icon }}</div>
                                    <h5>{{ sect.name }}</h5>
                                    <p>{{ sect.description }}</p>
                                    <div class="sect-bonus">ç‰¹è‰²: {{ sect.bonus }}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div v-if="player.sect" class="sect-info">
                            <div class="sect-header">
                                <div class="sect-icon">{{ getSectInfo().icon }}</div>
                                <div>
                                    <h4>{{ getSectInfo().name }}</h4>
                                    <p>è´¡çŒ®åº¦: {{ player.sectContribution }}</p>
                                    <p>ç­‰çº§: {{ player.sectLevel }}</p>
                                </div>
                            </div>
                            
                            <div class="sect-tasks">
                                <h5>å®—é—¨ä»»åŠ¡</h5>
                                <div 
                                    v-for="task in sectTasks" 
                                    :key="task.id"
                                    class="task-card"
                                >
                                    <h6>{{ task.name }}</h6>
                                    <p>{{ task.description }}</p>
                                    <div class="task-reward">å¥–åŠ±: {{ task.reward }}</div>
                                    <button 
                                        @click="acceptTask(task.id)"
                                        :disabled="task.accepted || !task.available"
                                        class="task-btn"
                                    >
                                        {{ task.accepted ? 'å·²æ¥å—' : 'æ¥å—ä»»åŠ¡' }}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ’è¡Œæ¦œé¢æ¿ -->
                    <div v-if="activeLeftTab === 'leaderboard'" class="tab-content">
                        <div class="leaderboard-tabs">
                            <button 
                                v-for="tab in leaderboardTabs" 
                                :key="tab.id"
                                :class="['leaderboard-tab', { active: activeLeaderboardTab === tab.id }]"
                                @click="activeLeaderboardTab = tab.id"
                            >
                                {{ tab.name }}
                            </button>
                        </div>
                        
                        <div class="leaderboard-content">
                            <div class="leaderboard-list">
                                <div 
                                    v-for="(player, index) in getLeaderboardData()" 
                                    :key="player.username"
                                    :class="['leaderboard-item', { self: player.username === currentUser.username }]"
                                >
                                    <div class="rank">{{ index + 1 }}</div>
                                    <div class="player-avatar">{{ getRankIcon(index + 1) }}</div>
                                    <div class="player-name">{{ player.username }}</div>
                                    <div class="player-value">{{ getLeaderboardValue(player) }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ±Ÿæ¹–èŠå¤©é¢æ¿ -->
                    <div v-if="activeLeftTab === 'chat'" class="tab-content">
                        <div class="chat-container">
                            <div class="chat-messages" ref="chatMessages">
                                <div 
                                    v-for="message in chatMessages" 
                                    :key="message.id"
                                    :class="['chat-message', { self: message.username === currentUser.username, admin: message.isAdmin }]"
                                >
                                    <div class="message-header">
                                        <span class="username">{{ message.username }}</span>
                                        <span v-if="message.isAdmin" class="admin-badge">ç®¡ç†å‘˜</span>
                                        <span class="timestamp">{{ formatChatTime(message.timestamp) }}</span>
                                    </div>
                                    <div class="message-content">{{ message.content }}</div>
                                </div>
                            </div>
                            
                            <div class="chat-input">
                                <input 
                                    v-model="chatInput" 
                                    @keyup.enter="sendMessage"
                                    placeholder="è¯´ç‚¹ä»€ä¹ˆ..."
                                    maxlength="200"
                                    class="chat-text-input"
                                >
                                <button @click="sendMessage" :disabled="!chatInput.trim()" class="send-btn">
                                    å‘é€
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ç®¡ç†å‘˜é¢æ¿ -->
                    <div v-if="activeLeftTab === 'admin' && isAdmin" class="tab-content">
                        <div class="admin-panel">
                            <h4>ğŸ›¡ï¸ ç®¡ç†å‘˜æ§åˆ¶å°</h4>
                            
                            <div class="admin-section">
                                <h5>ç”¨æˆ·ç®¡ç†</h5>
                                <div class="admin-users">
                                    <div 
                                        v-for="user in allUsers" 
                                        :key="user.username"
                                        class="admin-user-item"
                                    >
                                        <span class="user-name">{{ user.username }}</span>
                                        <span class="user-level">ç­‰çº§: {{ user.level || 1 }}</span>
                                        <div class="admin-actions">
                                            <button @click="banUser(user.username)" :disabled="user.banned" class="ban-btn">
                                                {{ user.banned ? 'å·²å°ç¦' : 'å°ç¦' }}
                                            </button>
                                            <button @click="unbanUser(user.username)" :disabled="!user.banned" class="unban-btn">
                                                è§£å°
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="admin-section">
                                <h5>ç³»ç»Ÿå…¬å‘Š</h5>
                                <textarea 
                                    v-model="adminAnnouncement" 
                                    placeholder="è¾“å…¥ç³»ç»Ÿå…¬å‘Š..."
                                    class="admin-textarea"
                                ></textarea>
                                <button @click="sendAnnouncement" class="admin-btn">
                                    å‘å¸ƒå…¬å‘Š
                                </button>
                            </div>
                            
                            <div class="admin-section">
                                <h5>æ¸¸æˆæ•°æ®</h5>
                                <div class="admin-stats">
                                    <div class="stat-item">
                                        <span>åœ¨çº¿ç”¨æˆ·: {{ onlineUsers }}</span>
                                    </div>
                                    <div class="stat-item">
                                        <span>æ€»æ³¨å†Œç”¨æˆ·: {{ totalUsers }}</span>
                                    </div>
                                    <div class="stat-item">
                                        <span>èŠå¤©æ¶ˆæ¯æ•°: {{ totalMessages }}</span>
                                    </div>
                                </div>
                                <button @click="clearChatHistory" class="admin-btn danger">
                                    æ¸…ç©ºèŠå¤©è®°å½•
                                </button>
                            </div>
                        </div>
                    </div>
                </aside>
                
                <!-- ä¸­å¤®å†…å®¹åŒº -->
                <section class="center-content">
                    <div class="center-tabs">
                        <button 
                            v-for="tab in centerTabs" 
                            :key="tab.id"
                            :class="['center-tab', { active: activeCenterTab === tab.id }]"
                            @click="activeCenterTab = tab.id"
                        >
                            {{ tab.icon }} {{ tab.name }}
                        </button>
                    </div>
                    
                    <!-- æ¢ç´¢å†…å®¹ -->
                    <div v-if="activeCenterTab === 'adventure'" class="center-panel">
                        <div class="locations-grid">
                            <div 
                                v-for="location in locations" 
                                :key="location.id"
                                class="location-card"
                            >
                                <div class="location-image">{{ location.icon }}</div>
                                <h4>{{ location.name }}</h4>
                                <p>{{ location.description }}</p>
                                <div class="location-rewards">
                                    <span>ä¿®ä¸º: {{ location.baseExp }}</span>
                                    <span>é‡‘å¸: {{ location.baseGold }}</span>
                                </div>
                                <button 
                                    @click="exploreLocation(location.id)"
                                    :disabled="exploring"
                                    class="explore-btn"
                                >
                                    {{ exploring ? 'æ¢ç´¢ä¸­...' : 'å¼€å§‹æ¢ç´¢' }}
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æˆ˜æ–—å†…å®¹ -->
                    <div v-if="activeCenterTab === 'battle'" class="center-panel">
                        <div v-if="!inBattle" class="enemies-grid">
                            <div 
                                v-for="enemy in enemies" 
                                :key="enemy.id"
                                class="enemy-card"
                            >
                                <div class="enemy-avatar">{{ enemy.avatar }}</div>
                                <h4>{{ enemy.name }}</h4>
                                <div class="enemy-stats">
                                    <div>ç”Ÿå‘½: {{ enemy.hp }}</div>
                                    <div>æ”»å‡»: {{ enemy.attack }}</div>
                                    <div>é˜²å¾¡: {{ enemy.defense }}</div>
                                </div>
                                <div class="enemy-rewards">
                                    <span>ä¿®ä¸º: {{ enemy.exp }}</span>
                                    <span>é‡‘å¸: {{ enemy.gold }}</span>
                                </div>
                                <button @click="startBattle(enemy.id)" class="challenge-btn">
                                    æŒ‘æˆ˜
                                </button>
                            </div>
                        </div>
                        
                        <!-- æˆ˜æ–—ç•Œé¢ -->
                        <div v-if="inBattle" class="battle-arena">
                            <div class="battle-participants">
                                <div class="participant player">
                                    <div class="participant-avatar">ğŸ§™â€â™‚ï¸</div>
                                    <h4>{{ currentUser.username }}</h4>
                                    <div class="health-bar">
                                        <div class="health-fill" :style="{ width: (player.hp / player.maxHp) * 100 + '%' }"></div>
                                        <span>{{ player.hp }}/{{ player.maxHp }}</span>
                                    </div>
                                </div>
                                
                                <div class="vs">VS</div>
                                
                                <div class="participant enemy">
                                    <div class="participant-avatar">{{ currentEnemy.avatar }}</div>
                                    <h4>{{ currentEnemy.name }}</h4>
                                    <div class="health-bar">
                                        <div class="health-fill" :style="{ width: (currentEnemy.hp / currentEnemy.maxHp) * 100 + '%' }"></div>
                                        <span>{{ currentEnemy.hp }}/{{ currentEnemy.maxHp }}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="battle-actions">
                                <button @click="battleAction('attack')" class="battle-btn">âš”ï¸ æ”»å‡»</button>
                                <button @click="battleAction('skill')" :disabled="player.mp < 10" class="battle-btn">ğŸ”¥ æŠ€èƒ½</button>
                                <button @click="battleAction('heal')" :disabled="player.mp < 8" class="battle-btn">ğŸ’š æ²»ç–—</button>
                                <button @click="battleAction('defend')" class="battle-btn">ğŸ›¡ï¸ é˜²å¾¡</button>
                            </div>
                            
                            <div class="battle-log">
                                <div v-for="(message, index) in battleMessages" :key="index" class="battle-message">
                                    {{ message }}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å•†åº—å†…å®¹ -->
                    <div v-if="activeCenterTab === 'shop'" class="center-panel">
                        <div class="shop-tabs">
                            <button 
                                v-for="category in shopCategories" 
                                :key="category.id"
                                :class="['shop-tab', { active: activeShopCategory === category.id }]"
                                @click="activeShopCategory = category.id"
                            >
                                {{ category.icon }} {{ category.name }}
                            </button>
                        </div>
                        
                        <div class="shop-items">
                            <div 
                                v-for="item in getShopItems()" 
                                :key="item.id"
                                class="shop-item"
                            >
                                <div class="item-icon">{{ item.icon }}</div>
                                <h4>{{ item.name }}</h4>
                                <p>{{ item.description }}</p>
                                <div class="item-price">{{ item.price }} é‡‘å¸</div>
                                <button 
                                    @click="buyItem(item)"
                                    :disabled="player.gold < item.price"
                                    class="buy-btn"
                                >
                                    è´­ä¹°
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- å³ä¾§é¢æ¿ -->
                <aside class="right-panel">
                    <div class="panel-tabs">
                        <button 
                            v-for="tab in rightTabs" 
                            :key="tab.id"
                            :class="['tab-btn', { active: activeRightTab === tab.id }]"
                            @click="activeRightTab = tab.id"
                        >
                            {{ tab.icon }} {{ tab.name }}
                        </button>
                    </div>
                    <!-- æ¸¸æˆæ—¥å¿—é¢æ¿ -->
                    <div v-if="activeRightTab === 'log'" class="tab-content">
                        <div class="panel-header">
                            <h4>ğŸ“œ æ¸¸æˆæ—¥å¿—</h4>
                        </div>
                        <div class="game-log">
                            <div 
                                v-for="(log, index) in gameLogs" 
                                :key="index"
                                :class="['log-entry', log.type]"
                            >
                                <span class="log-time">{{ log.time }}</span>
                                <span class="log-message">{{ log.message }}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ç‚¼ä¸¹é¢æ¿ -->
                    <div v-if="activeRightTab === 'alchemy'" class="tab-content">
                        <div class="alchemy-container">
                            <h4>ğŸ§ª ç‚¼ä¸¹ç‚‰</h4>
                            
                            <div class="alchemy-furnace">
                                <div class="furnace-status">
                                    <div v-if="alchemyInProgress" class="furnace-active">
                                        <div class="fire-animation">ğŸ”¥</div>
                                        <p>ç‚¼åˆ¶ä¸­... {{ alchemyTimeLeft }}ç§’</p>
                                        <div class="progress-bar">
                                            <div class="progress-fill" :style="{ width: ((alchemyDuration - alchemyTimeLeft) / alchemyDuration) * 100 + '%' }"></div>
                                        </div>
                                    </div>
                                    <div v-else class="furnace-idle">
                                        <div class="furnace-icon">âš—ï¸</div>
                                        <p>ç‚¼ä¸¹ç‚‰ç©ºé—²ä¸­</p>
                                    </div>
                                </div>
                                
                                <div class="recipe-selection">
                                    <h5>é€‰æ‹©ä¸¹æ–¹</h5>
                                    <div class="recipes-grid">
                                        <div 
                                            v-for="recipe in alchemyRecipes" 
                                            :key="recipe.id"
                                            :class="['recipe-card', { available: canCraftRecipe(recipe) }]"
                                            @click="startAlchemy(recipe)"
                                        >
                                            <div class="recipe-icon">{{ recipe.icon }}</div>
                                            <h6>{{ recipe.name }}</h6>
                                            <div class="recipe-materials">
                                                <div v-for="material in recipe.materials" :key="material.name" class="material">
                                                    {{ material.name }} x{{ material.count }}
                                                </div>
                                            </div>
                                            <div class="recipe-result">äº§å‡º: {{ recipe.result }}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- è£…å¤‡å¼ºåŒ–é¢æ¿ -->
                    <div v-if="activeRightTab === 'enhance'" class="tab-content">
                        <div class="enhance-container">
                            <h4>âš’ï¸ è£…å¤‡å¼ºåŒ–</h4>
                            
                            <div class="enhance-area">
                                <div class="equipment-slot">
                                    <h5>é€‰æ‹©è£…å¤‡</h5>
                                    <div class="equipment-grid">
                                        <div 
                                            v-for="equipment in getEnhanceableEquipment()" 
                                            :key="equipment.id"
                                            :class="['equipment-card', { selected: selectedEquipment?.id === equipment.id }]"
                                            @click="selectEquipment(equipment)"
                                        >
                                            <div class="equipment-icon">{{ equipment.icon }}</div>
                                            <div class="equipment-info">
                                                <h6>{{ equipment.name }}</h6>
                                                <p>+{{ equipment.level || 0 }}</p>
                                                <div class="equipment-stats">
                                                    <div v-for="(value, stat) in equipment.stats" :key="stat">
                                                        {{ stat }}: +{{ value }}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div v-if="selectedEquipment" class="enhancement-panel">
                                    <h5>å¼ºåŒ– {{ selectedEquipment.name }}</h5>
                                    <div class="enhancement-info">
                                        <p>å½“å‰ç­‰çº§: +{{ selectedEquipment.level || 0 }}</p>
                                        <p>æˆåŠŸç‡: {{ getEnhanceSuccessRate(selectedEquipment) }}%</p>
                                        <p>æ‰€éœ€ææ–™: å¼ºåŒ–çŸ³ x{{ getEnhanceCost(selectedEquipment) }}</p>
                                        <p>æ‰€éœ€é‡‘å¸: {{ getEnhanceGoldCost(selectedEquipment) }}</p>
                                    </div>
                                    
                                    <div class="enhancement-preview">
                                        <h6>å¼ºåŒ–åå±æ€§é¢„è§ˆ:</h6>
                                        <div v-for="(value, stat) in getEnhancedStats(selectedEquipment)" :key="stat" class="stat-preview">
                                            {{ stat }}: +{{ selectedEquipment.stats[stat] }} â†’ +{{ value }}
                                        </div>
                                    </div>
                                    
                                    <button 
                                        @click="enhanceEquipment(selectedEquipment)"
                                        :disabled="!canEnhanceEquipment(selectedEquipment)"
                                        class="enhance-btn"
                                    >
                                        å¼ºåŒ–è£…å¤‡
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>
            </main>
        </div>
        
        <!-- ç¦»çº¿ä¿®ç‚¼å¥–åŠ±å¼¹çª— -->
        <div v-if="showOfflineModal" class="offline-modal-overlay">
            <div class="offline-modal">
                <div class="offline-header">
                    <h3>ğŸŒ™ ç¦»çº¿ä¿®ç‚¼æ”¶è·</h3>
                    <p>æ¬¢è¿å›æ¥ï¼ä½ åœ¨ç¦»çº¿æœŸé—´è·å¾—äº†ä»¥ä¸‹æ”¶è·ï¼š</p>
                </div>

                <div v-if="offlineProgress" class="offline-content">
                    <div class="offline-stats">
                        <div class="offline-stat">
                            <span class="stat-icon">â°</span>
                            <span class="stat-label">ä¿®ç‚¼æ—¶é—´</span>
                            <span class="stat-value">{{ offlineProgress.hours_cultivated.toFixed(1) }}å°æ—¶</span>
                        </div>

                        <div class="offline-stat">
                            <span class="stat-icon">â­</span>
                            <span class="stat-label">è·å¾—ç»éªŒ</span>
                            <span class="stat-value">{{ offlineProgress.exp_gained }}</span>
                        </div>

                        <div v-if="offlineProgress.cost_paid > 0" class="offline-stat">
                            <span class="stat-icon">ğŸ’°</span>
                            <span class="stat-label">æ¶ˆè€—{{ offlineProgress.cost_type === 'spirit_stones' ? 'çµçŸ³' : 'é‡‘å¸' }}</span>
                            <span class="stat-value">{{ offlineProgress.cost_paid }}</span>
                        </div>

                        <div class="offline-stat">
                            <span class="stat-icon">ğŸ§˜</span>
                            <span class="stat-label">ä¿®ç‚¼æ–¹å¼</span>
                            <span class="stat-value">{{ getCultivationTypeName(offlineProgress.cultivation_type) }}</span>
                        </div>
                    </div>

                    <div class="offline-actions">
                        <button @click="claimOfflineRewards" class="claim-offline-btn">
                            é¢†å–å¥–åŠ±
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- é€šçŸ¥ç³»ç»Ÿ -->
        <div class="notifications">
            <div
                v-for="notification in notifications"
                :key="notification.id"
                :class="['notification', notification.type]"
            >
                {{ notification.message }}
            </div>
        </div>
    </div>
    
    <script src="game.js"></script>
</body>
</html>